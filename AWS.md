# AWS

## cloud watchで請求アラートを受け取る設定をする

請求ダッシュボードで、利用額のアラートを受信するよう設定する。

- マイ請求ダッシュボード
- Billingの設定
- cloud　watchの画面
- アラートの作成

$10超過でgmailにアラートが来るように設定した


## 作業用ユーザの作成(IAMユーザ・アイアムユーザ)


### ユーザの種類
- ルートユーザ
- IAMユーザ

が存在している。


### 作業の流れ

- サービス
- IAMと検索窓に入力してアクセス
- ユーザ
- ユーザを追加
- AWSマネジメントコンソールへのアクセス
- 名前・パスワードなどを設定
- 既存のポリシーを直接アタッチ(AWSがもともと用意してくれている権限をもったグループ)
- AdministratorAccessの権限を付与する(フルアクセス)
- 作成終了


## CloudTrailで操作ログを記録する


### ログをとるには

AWSでいつ誰が何をしたかを記録しておく。
cloud trailで録ったロログをS3に記録する。

- CloudTrailで証跡を作成する(90日間のログはデフォルトで90日)
- S3(ストレージ)の料金はかかる(とても安価)

### 作業の流れ

- サービスから、cloudtrailで検索
- 証跡情報
- 証跡の作成
- s3
- アカウントのすべてのS3バケットの選択
- S3バケットを作成(S3バケット＝フォルダみたいなもの)
- 名前をつける。グローバルで一意でなければならない
- practice20200816というS3のバケット名で作成

## VPC　ネットワークを構築する

### 単語

#### リージョン
AWSのサービスが提供されている地域のこと。
日本でサービスを提供する場合は東京リージョンがおすすめ。(応答時間が早くなる。)


#### アベイラビリティゾーン
データセンタのこと。
どのリージョンにもアベイラビリティゾーンが2つ以上ある。
可用性を担保する。
災害が起こってもサービスが稼働し続けることができる。


#### VPCとは

virtual private cloudのこと。
AWS上で、仮想ネットワークを作成できるサービスのこと。
固有のネットワークを作成することができる。

VPCを作成するときはリージョンを指定して作成する。


#### サブネット

ネットワークを区切る役目。
VPCの中にサブネットを2つ作成する。

- １個目
パブリック＝インターネットに公開する
- ２個目
プライベート＝公開しない

#### ルーティング

どのIPアドレスがどのIPアドレスに紐づいているのか、管理するもの。
デバイスのIPアドレスとそのデバイスが所属するIPアドレスを管理するもの。
ルートテーブルで管理する。
ルータ(ネットワーク層でIPアドレスを管理する)で管理する。

#### デフォルトルート
0.0.0.0

ルートテーブル以外に設定しているIPアドレスが来た時に送信するIPアドレス

##### ルートテーブルについて

<項目>
- 宛先IPアドレス
- 次のルータ(AWSの呼び名はターゲット)

ルータAのルートテーブル
|宛先IPアドレス|次のルータ|
|---|---|
|10.0.1.0/24|local|
|10.0.2.0/24|ルータB|
|0.0.0.0/24|ルータC|

local=自身のネットワークのこと
つまり、10.0.1.0は自身(ルータA)が管理する。

2行目＝10.0.2.0/24に所属するIPアドレスはルータBが管理している。なので、ルータBに回せば良い。

3行目=1行目にも、2行目にも当てはまらないIPアドレスを受け取った時に回す。

###### 0.0.0.0
デフォルトルート＝ルートテーブルに登録されている、どのアドレスにも一致しない場合の経路。


#### IPアドレス
ネットワーク上のノードを識別するための住所。


##### IPアドレスの種類(2種類)
- パブリックIPアドレス：
    - インターネットに接続する際に使用するIPアドレス
    - ICANN(アイキャン)という団体が管理しており、一意となるように管理している。
    - 一般事業者は、プロバイダ・サーバ事業者から貸し出される。(AWSを使用する際はAWSから貸し出される)

- プライベートIPアドレス：
    - インターネットで使用されないIPアドレス
    - インターネットで使用されないIPアドレス
    - 使用して良いプライベートIPアドレスが決まっている。
        10.0.0.0 〜　10.255.255.255
        172.16.0.0 〜 172.31.255.255
        192.168.0.0 〜 192.168.255.255
    - 社内LANの構築などプライベートIPアドレスを使用する。


##### IPアドレスの詳細

ネットワーク部とホスト部にわけられる。

- ネットワーク部
    サブネットのこと。
    どのネットワーク内のノードか表す。
- ホスト部
    ネットワーク内のどのノードか表す。

##### IPアドレスの書き方
2つの表記方法がある。

- CIDR表記
    192.168.128.0/24

- サブネットマスク表記
    192.168.128.0/255.255.255.0




### 全体像

インターネット - webサーバ(パブリックサブネット) - DBサーバ(プライペートサブネット)

- webサーバには
    - インストールされているソフト
    wordpress
    apache
    OS
    - サブネット
    パブリック=インターネットから接続できる
- DBサーバ
    - インストールされているソフト
    mySQL
    os
    - サブネット
    プライベート=インターネットから接続されない。隠されている。(データを保護するため。)


wordpress=ブログやホームページを作成できるシステム




### ネットワーク

VPCの中に、パブリックサブネットとプライベートサブネットが存在する。


- VPC
東京リージョン
(アベイラビリティゾーンが3つある。ap-northeast-1a,1c,1d)


IPアドレス：10.0.0.0/16

    - パブリックサブネット
        IPアドレス：10.0.10.0/24

    - プライベートサブネット
        IPアドレス：10.0.20.0/24


### 全体の流れ
- 1.VPCを作成する。
- 2.サブネットを作成する
- 3.ルーティングを設定する
    - インターネットゲートウェイを作成→VPCにアタッチする
    - ルートテーブルを作成し、パブリックサブネットに紐づける。

### VPCの作成
VPCはdefaulで作成されている。

default使用しない。
新規に作成して使用する。

サービス>VPC
- 名前：なんでも良い aws-and-infra-vpc
- IPv4: 10.0.0.0/16
- IPv6: IPv6をamazonが用意しているもので、紐づけることが可能。ここでは必要ないので、なし。
- テナンシー：専有にするとEC2の料金が割高になる。

### サブネットを作成する

- 分割すると良いこと
    - アベイラビリティゾーンが分けられ、対障害性が上がる
    - セキュリティ上、インターネットに公開したくない機器を置く場所を作成できる(プライベートサブネット)

パブリックサブネット=インターネットから接続できる
プライベートサブネット=DBサーバをおく  

### パブリックサブネット用のサブネット作成

サービス>VPC>左のタブからサブネット
- 名前：aws_infra_public_subnet_1a
- VPC：先ほど作成したVPC
- アベイラビリティゾーン:1aを選択
- IPv4:10.0.10.0/24

### プライベートサブネット用のサブネット作成

続けて作成する
- 名前：aws_infra_private_subnet_1a
- VPC：先ほど作成したVPC
- アベイラビリティゾーン:1aを選択
- IPv4:10.0.20.0/24

### ルーティングを作成する

パブリックサブネットからインターネットに接続できるようにしたい。
パブリックサブネット上のサーバに対して、ソフトウェアをインターネットから、インストールしたいため。



#### ルーティング設定前

VPCとルートテーブルが紐づいている。

<現状のテーブル内容>

インターネットとVPCの間のルータのテーブル。
|送信先|ターゲット|
|---|---|
|10.0.0.0/16|local|

- 10.0.0.0/16に含まれるアドレス宛ての通信は自身に送信。

- 10.0.0.0/16宛て以外の通信全て破棄する。

#### ルーティング設定後


<修正後のテーブル内容>

インターネットとVPCの間のルータのテーブル。
|送信先|ターゲット|
|---|---|
|10.0.0.0/16|local|
|0.0.0.0/16|インターネットゲートウェイ|

- 10.0.0.0/16に含まれるアドレス宛ての通信は自身に送信。

- 10.0.0.0/16宛て以外の通信(0.0.0.0/0)はインターネットゲートウェイに接続する。


これにより、パブリックサブネット(10.0.10.0/24)からインターネットへの接続が可能になる。
ルートテーブルはインターネットに接続できるようにするための設定。

<補足>

- ルートテーブルは各サブネットに対して設定できる。
- ルータを明示的に作成することはAWS上ではやらないが、
    - サブネットを作成
    - ルーティングを設定
    
    することによって、ルータが暗黙的に作成される。


### 具体的な作業

- インターネットゲートウェイを作成し、VPNにアタッチする。
- ルートテーブルを作成し、パブリックサブネットに紐づける。

## 手順

- インターネットゲートウェイを作成し、VPNにアタッチする。


1. サービスからVPC
2. インターネットゲートウェイ
3. インターネットゲートウェイの作成
4. aws-and-infra-igw　と名前をつけて作成。
5. vpcにアタッチ
6. aws-and-infra-vpcを選択
7. アタッチする

- ルートテーブルを作成し、パブリックサブネットに紐づける。

1. サービスからVPC
2. ルートテーブル
3. aws-and-infra-vpcに紐づいているルートテーブル(ルートテーブルの上の方にあるルートテーブル)
4. そのルートをみる
5. 10.0.0.0/16(送信先)、local(ターゲット)となっている(確認終わり。)
6. ルートテーブルの作成
7. 名前タグ:aws-and-infra-public-route
7. VPC:aws-and-infraを紐付け
8. 作成
9. aws-and-infra-public-routeを選択
10. サブネットの関連付け
11. サブネットの関連付けの編集
12. aws_infra_public_subnet_1aを選択
13. 保存(このルートテーブルをpublicサブネットに割り当てることができた。)
14. aws-and-infra-public-routeを選択
15. ルート
16. ルートの編集
17. ルートの追加
18. 送信先：0.0.0.0/0
19. ターゲット：InterNetGatewayを選択(先ほど作成したinternet gatewayを選択)
20. ルートの保存


## ネットワークを設計するポイント
#### VPCの設計のポイント

- プライベートIPアドレス範囲から指定する。(globalIPアドレスで作れないこともない。)
がしかし、仮想のプライベートネットワーク空間を作成するので、プライベートIPアドレスの使用が推奨されている。
    - クラスA　：10.0.0.0 ~ 10.255.255.255
    - クラスA　：172.16.0.0 ~ 172.31.255.255
    - クラスA　：192.168.0.0 ~ 192.168.255.255

- 作成後は変更できないため、大きめに設定する。
    - VPCのサイダー領域は/28から/16まででしか設定できないようになっている。大きめに設定する。(/16が推奨)
- オンプレミスや他のVPCのレンジと重複しないように気を付ける。

#### VPCをどの単位で分割するか？

- アカウントを分けるかどうか？
    - 異なるシステムはアカウントを分ける
    - 同一システムの場合は分けなくても良い。

- 同一システム、複数環境(開発環境、本番環境)の場合はどうするのか？(そもそもアカウントをわけるか、同一アカウントでVPCをわけるか？)
    - 同一アカウントでVPCを分けるのが良い。また、リージョンも分けるのがおすすめ。
    - なぜ？
        - 環境が違う場合、アカウントもVPCも同一の物を使用するのはだめ
        - vpcを分けると、IAMの設定が一度で良い。
        - 反面環境のリソースが見えてしまい、事故のもとになる
        - アカウントごとにわけると他の環境のリソースが見えず、作業しやすい。
        - 反面、環境ごとにIAMの設定が必要。


#### サブネットの設計のポイント

- 将来的に必要なIPアドレス数を見積もって設計する(広めのIPを持っておく。)
    - /24が標準的
    - 足りなくなって困らないように
    - /16のVPC内にサブネットを256個作成できる。
    - 一つのサブネット内にIPアドレスを254個もてるので、そんなに困ることがない。

- サブネットの分割はルーティングとアベイラビリティゾーンを基準におこなう。
    - サブネットに割り当てられるルートテーブルは一つ
    - インターネットアクセエスの有無、拠点アクセスの有無などのルーティングポリシーに応じて分割する。
    - 高可用性のために、2つ以上のアベイラビリティゾーンを使用する。

### 宿題

サブネットを別のアベイラビリティゾーン(c1)で作成(10.0.30.0/24)して、
ルートテーブル(0.0.0.0/0をinternet gatewayに送るルートテーブル)にアタッチした。



## EC2、webサーバを構築する

- EC2の仮想サーバを作成
- sshする
- apacheをインストール
- firewallの設定
- Elastic IPアドレスを固定する

パブリックサブネット(10.0.10.0/24)にwebサーバを構築する

### EC2インスタンスを設置する

#### EC2とはなんぞや

Elastic compute cloudの略。
仮想サーバ。

- 数分で起動、一時間または秒単位の従量課金
- OSより上のレイヤは自由に設定可能

#### AMI

AMI=サーバのテンプレート。EC2インスタンスの起動に必要な情報が入った、OSのイメージ。

#### インスタンスタイプ
CPU,メモリ、ストレージ、ネットワーク帯域がタイプによって異なる.



m5.xlarge

m=インスタンスファミリー(特徴がことなる。)
5=インスタンス世代(極力最新世代を使用する)
xlarge=インスタンスサイズ

#### EC2のストレージ
サーバにくっつけるデータの保存場所。
EC2のストレージには2種類ある。


- EBS
    EC2インスタンスをterminateしてもEBS上のデータは保存可能
    (通常こちらをしようする。)

- インスタンスストア
    EC2インスタンスをterminateするとデータが消えてします。
    お金がかかる。
    (キャッシュな度使用する。)

####　手順

1. サービスからEC2
2. AMI:amazon linux2
3. インスタンスタイプ:t2micro(アクセス数に制限がかかっている。)
4. インスタンスの詳細：ネットワーク：作成したvpc
5. インスタンスの詳細：サブネット：publicサブネットを選択(インターネットに接続したいので)
6. 自動割り当てパブリックIP(グローバルIPアドレスをつけるか)：有効
7. ストレージの追加：そのまま
8. タグ：キー：Name
9. タグ：値：aws-and-infra-web
10. セキュリティグループ：そのまま(より安全にするには、sshできるIPアドレスを指定する。自宅のルータのIPとかにする。)
11. 起動
12. キーペアの作成
13. 起動

#### ssh接続

EC2に入る時は、ec2-userを指定してログインする。
ちなみにこのコマンドはEC2インスタンス画面の接続を押すとちゃんと出てきてくれる。

```
  ssh -i "was-and-infra-ssh-key.pem" ec2-user@54.199.15.238 
```
#### ポート番号とは

ssh接続すると、sshdというプログラムが動いているため、ssh接続先サーバで操作をできる。

ポート番号=プログラムのアドレス・
同一コンピュータないで通信を行うプログラムを識別する時に利用される。

ssh=22
http=80
smtp=25
https=443

##### ポート番号の決め方
- 標準で決められている番号

代表的なプログラムが使用するポート番号。
ウェルノウンポート番号

接続する先のポート番号を省略した時はウェルノウン番号が使用される。

- 動的に決まる番号

サーバ(サービス提供側):ポート番号が決まっている必要あり。
クライアント(接続元):ポート番号は決まってなくて良い。(他のポート番号とかぶらないようにして、ランダムに決める)

49142 ~ 65535
のいずれかの整数値をとる。

```
#どのポートでどのプログラムが受け付けているか
#i=サーバの待機ポートとプロセスを表示
#n=IPアドレスをホスト名に変換しないオプション
#P=ホスト名をサービスに変換しないオプション
sudo lsof -i -n -P
```

(LISTEN)＝相手からの通信を待ち受けている物
(ESTABLISHED)＝通信が確立されている物

### apacheをインストールする

yum = パッケージ管理ツール
```
#yum を最新版にする
#yオプション＝yesオプション(yの入力を省略)
$ sudo yum update -y
```

ec2-userは一般ユーザ


```sh
#httpdはapacheを構成する実行ファイル(httpdをインストール＝apacheをインストーる)
sudo yum install -y httpd
#サービス起動
sudo systemctl start httpd.service

```


```sh
##############起動確認(何種類か)

sudo systemctl status httpd.service

#ax=全てのプロセスを表示する
#u=CPUの使用率、メモリの使用率を合わせて表示
ps aux | grep httpd

```

```sh
# apacheの自動起動の設定
#enable=自動起動設定
sudo systemctl enable httpd.service

```

```sh
# 自動起動設定がされているか確認
# enabledになっていれば自動起動設定ができている
sudo systemctl is-enabled httpd.service
```

### ファイアウォールを設定する

AWS上でファイアウォールの役割を担っているのは、セキュリティグループ


ファイアウォールの設定がされているため、
22番しか開いていない。

- インバウンド＝EC2の中に入ってくる接続の設定
- アウトバウンド＝外に出ていく(インターネットに出ていく)接続の設定



#### 設定前の確認

EC2のパブリックIPアドレスをブラウザの窓からアクセス。
http://13.114.181.61

もちろん応答しない。


#### ファイアウォールの設定方法

マネジメントコンソール→セキュリティグループ
→defaultじゃないセキュリティグループ(これが作成したEC2に対してかかっているセキュリティ)

→インバウンドルールの追加

- HTTP
- TCP
- 80
- 任意の場所


<確認>
EC2のパブリックIPアドレスをブラウザの窓からアクセス。
http://13.114.181.61



#### Elastic IPアドレスを指定してIPアドレスの固定

固定のグローバルIPアドレスを取得でき、インスタンスに付与できるというサービス。
インスタンスの削除まで使用できる。


##### 注意！！！！
EC2インスタンスに関連づけられていて、インスタンスが起動中の場合は課金されない

がしかし、EC2に紐づけられていなかったり、EC2が停止していると課金される。


- 課金されない方法!!!!!!

Elastic IP
→アクション
→アドレスの関連付けの解除
→**アドレスの解放**

を必ず行う！！！！！！




##### 手順

マネジメントコンソール
→EC2
→Elastic IP
→Elastic IPアドレスの割り当て
→割り当て(IPアドレスを確保できた！)


EC2インスタンスに紐づける

Elastic IP アドレスの関連付け
→
- インスタンス
- IPv4(作成したEC2のやつ。項目に出てきたやつをクリック)
- プライベートIPアドレス(作成したEC2のやつ。項目に出てきたやつをクリック)

ブラウザから、取得したIPアドレスでアクセス

接続できる。


### 後片付け

1. elastic IPアドレスを開放する
2. EC2インスタンスを停止する

## Route53 ドメインを登録する

### ドメインとは

DNSとかはIPとドメイン名を相互に変換している。

www.google.comみたいなやつ。


実際にドメインを購入するためお金がかかる。

### なにを構築するか

- www.example.comというドメインを購入
- IPアドレスとひもづける
- AWS上の紐づけたIPアドレスをもつEC2にアクセスできるようになる。

### ドメインについて
- ピリオドで4つに区切られている

- www.example.co.jp

- 第四レベルドメイン・第三レベルドメイン・第二レベルドメイン・トップレベルドメイン


- ICANNがドメイン全体を管理(トップレベルドメインを管理する団体(レジストリ)を任命)
    - レジストリがひとつのドメインを管理する(レジストラにおろす)
        - レジストラが一般消費者に販売する(リセラにおろす)
            - リセラ(一般消費者に販売)

- レジストラ＝ドメインの登録事業者
- リセラ＝再販事業者。レジストラからおろしてもらった物を使用している。


### DNSについて

- domain name system
- ドメイン名の管理システム。ドメイン名をIPアドレスに変換する
- ネームサーバとフルリゾルバの2つから構成されている
- DNSの「ドメイン名とIPアドレスの紐付け」一つ一つのことをリソースレコードという。(AWSででてくる)

### ネームサーバ
- ドメイン名とそれに紐づくIPアドレスが登録されているサーバ
- ドメインの階層ごとにネームサーバが配置されている。
- 管理する階層のドメイン名とIPアドレスが管理されている。


### フルリゾルバ

- このドメインに紐づくIPアドレスを教えてって頼むと色々なネームサーバに問い合わせて教えてくれる。
- DNSの秘書みたいな物。

### webページが表示される仕組み

1. http://www.example.comでブラウザアクセス
2. webブラウザがフルリゾルバにIPアドレスを問い合わせる
3. フルリゾルバがルートネームサーバにIPアドレスを問い合わせる
4. ルートネームサーバがcomのネームサーバに問い合わせて、とフルリゾルバに返す
5. フルリゾルバがcomのネームサーバにIPアドレスを問い合わせる
6. comのネームサーバがexample.comネームサーバに問い合わせて、とフルリゾルバに返す
7. フルリゾルバがexample.comのネームサーバにIPアドレスを問い合わせる
8. example.comのネームサーバがwww.example.comのネームサーバに問い合わせて、とフルリゾルバに返す
9. フルリゾルバがwww.example.comのネームサーバにIPアドレスを問い合わせる
10. www.example.comのネームサーバがIPアドレスをフルリゾルバに返す


しばらくの間はフルリゾルバがキャッシュしてもっている。


### DNSはドメイン名とIPアドレス以外も管理している

- MXレコード(ドメインに紐づくメール受信サーバ)
- SOA(ドメインのゾーン情報)

### ドメインを登録する手順

- ドメインを購入できるのは、レジストラとリセラから。
- 購入するお店のポイント。価格。反映変更の速さ。無料オプションの充実度。
- お名前.com：おすすめ！国内最大のレジストラ
- https://www.onamae.com
- hinamae.work
- 自動更新の設定はオフにしておく
- 1円/年　で契約した！

### Route53
#### 特徴
- AWSのDNSサービス
- ネームサーバのほう
- 高可用性。SLA100%=おちることはない。
- 高速。Route53が提供される場所をエッジロケーションという。
- フルマネージドサービス。DNSサーバの設計・構築・維持管理が不要。障害監視・バックアップサービスなどAWS側がすべてやってくれる。


#### 単語集
- ホストゾーン
    DNSのリソースレコードの集合。
- レコードセット
    リソースレコードのこと。DNSの名前とIPアドレスのセットになっているレコード。
- ルーティングポリシー
    Route53がレコードセットに対してどのようにルーティングを行うか決める
- ヘルスチェック
    サーバの稼働状態

#### ルーティングポリシー
複数のルールが存在する。
選べる。

- シンプルルーティング
    レコードセットにもとづいて、ドメインへの問い合わせに応答
- 加重ルーティング
    エンドポイントが複数あ流場合。設定された重み付けに基づいてドメインの問い合わせに応答。
    ABテスト時などに使用する。
- レイテンシールーティング
    リージョン間の遅延が少ない方のリソースへルーティングする。
- 位置情報ルーティング
    地域限定配信時に利用。場所によってドメインへの問い合わせの対応の仕方をかえる。
- フェイルオーバー
    ヘルスチェックの結果に基づいて、障害発生していないリソースへルーティング。
    障害発生時にsorryサーバにかんたんにきりかえられる。

#### route53でDNSを設定する

##### <現状>
1. http://hinamae.workでブラウザアクセス
2. webブラウザがお名前.comのDNSサーバに問い合わせる
3. お名前.comのDNSサーバにはhinamae.workとIPアドレスのセットのレコード(レコードセット)は登録されていない→名前解決できない


##### <変更後>
1. http://hinamae.workでブラウザアクセス
2. webブラウザがRoute53のDNSサーバに問い合わせる
3. Route53がhinamae.workとIPアドレス(レコードセット)から名前解決を行う

やりたいことは、hinamae.workに紐づくネームサーバがRoute53になること

##### 手順

#### ホストゾーンの作成
AWSマネジメントコンソール
→Route53
→ホストゾーン
→ホストゾーンの作成
→ドメイン名の入力：hina.work
→タイプ：パブリックホストゾーン(インターネットから接続する場合はこちら)


ちなみに、プライベートホストゾーンは、awsないのネットワークのなかで、IPアドレスではなく、ドメイン名でアクセスしたい場合に使用する



- NSレコード：ドメインを管理するネームサーバとの紐付け(hina.workに紐づくネームサーバ情報を表示する)
- SOAレコード：ドメインを管理するゾーン情報

#### お名前.comでドメインのネームサーバを変更する

(この後の作業の前提)
- インスタンスを起動
- そのインスタンスにElastic　IPが関連づけられている
- Elastic IPをメモっておく:54.199.15.238 



sshしてログイン
```
$  ssh -i "was-and-infra-ssh-key.pem" ec2-user@54.199.15.238
```

```
#IPアドレスに紐づくドメインを調べたい時に使用する
# NS =　ネームサーバを知りたい時
# +short = ネームサーバだけの情報を表示させたいので

$dig hina.work NS +short

01.dnsv.jp.
02.dnsv.jp.
03.dnsv.jp.
04.dnsv.jp.
```


[やっていること]digコマンドで、hina.workの名前解決のレコードをもったネームサーバを調べている。


[結果]workのネームサーバに問い合わせがあった際workのネームサーバは
dnsv.jp.のネームサーバにあるよ、と返している

= お名前.comでドメインを取得した際、デフォルトで、workのネームサーバはdnsv.jp.のネームサーバを返すようになっている。

→お名前.comでをworkのネームサーバが返すネームサーバを、dnsv.jp.からRoute53に設定を変更する必要あり！


AWSマネジメントコンソール
→Route53
→ホストゾーン
→NS
→値/トラフィックのルーティング先の4つのネームサーバをメモしておく
(ns-814.awsdns-37.net.
ns-1819.awsdns-35.co.uk.
ns-1283.awsdns-32.org.
ns-275.awsdns-34.com.)
→お名前.com
→ネームサーバの変更
→その他(その他のネームサーバをつかう)
AWSコンソールでメモしたネームサーバを4つ上から順に貼り付ける
(最後の.は張り付けない)

設定が反映されるのに時間がかかる

反映されたかは、digコマンドで確認できる。

#### ドメイン名にEC2のIPアドレスを紐づける
<やること>
Route53にドメイン名とIPアドレスを紐づけるAレコードを登録する

<現状>
ホストゾーンには、
- NSレコード
- SOAレコード
しか登録されていない

<手順>
AWSマネジメントコンソール
→Route53
→ホストゾーン
→レコードセットの作成
→ルーティングポリシー：シンプルルーティング
→シンプルなレコードを定義
→値/トラフィックのルーティング先：レコードタイプに応じたIPアドレスまたは別の値、EC2のパブリックIPアドレスを紐づける
→名前：空にする
→レコードを作成


hina.workにブラウザからアクセスする




